<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>Jasmine Test Runner</title>
  <link rel="stylesheet" type="text/css" href="lib/jasmine-0.11.1/jasmine.css">
  <script type="text/javascript" src="lib/jasmine-0.11.1/jasmine.js"></script>
  <script type="text/javascript" src="lib/jasmine-0.11.1/jasmine-html.js"></script>

<!-- these includes only work from the project root,
  including the original project files: -->
  
  <!-- include source files here... -->
  <script type="text/javascript" src="src/JsfIoc.js"></script>
  <script type="text/javascript" src="src/DependencyGraphing.js"></script>
  <script type="text/javascript" src="src/FakeJsfIoc.js"></script>
  <script type="text/javascript" src="src/ParameterTypes.js"></script>
  <script type="text/javascript" src="src/Some.js"></script>

  <!-- include spec files here... -->

  <script type="text/javascript" src="spec/DependencyGraphing.tests.js"></script>

 <!-- these includes only work from the build folder,
  including the combined/built javascript 

  <script type="text/javascript" src="JsfIoc.js"></script>
  <script type="text/javascript" src="JsfIoc.tests.js"></script>
-->


<!-- the following requirements are test only -->
  <script type="text/javascript" src="lib/jquery/jquery-1.4.2.js"></script>
  <script type="text/javascript" src="lib/json2/json2.js"></script>

  <script type="text/javascript" src="lib/jsviz/0.3.3/physics/Particle.js"></script>
  <script type="text/javascript" src="lib/jsviz/0.3.3/physics/Particle.tests.js"></script>
  <script type="text/javascript" src="lib/jsviz/0.3.3/physics/PreferredDistanceCalculator.js"></script>
  <script type="text/javascript" src="lib/jsviz/0.3.3/physics/PreferredDistanceCalculator.tests.js"></script>
  <script type="text/javascript" src="lib/jsviz/0.3.3/physics/RectangleParticle.js"></script>
  <script type="text/javascript" src="lib/jsviz/0.3.3/physics/RectangleParticle.tests.js"></script>



</head>
<body>
    <script type="text/javascript">
      jasmine.getEnv().addReporter(new jasmine.TrivialReporter());
      jasmine.getEnv().execute();
    </script>


	<script language="JavaScript" src="lib/jsviz/0.3.3/physics/ParticleModel.js"></script>
	<script language="JavaScript" src="lib/jsviz/0.3.3/physics/Magnet.js"></script>
	<script language="JavaScript" src="lib/jsviz/0.3.3/physics/Spring.js"></script>
	<script language="JavaScript" src="lib/jsviz/0.3.3/physics/Particle.js"></script>
	<script language="JavaScript" src="lib/jsviz/0.3.3/physics/RectangleParticle.js"></script>
	<script language="JavaScript" src="lib/jsviz/0.3.3/physics/PreferredDistanceCalculator.js"></script>
	<script language="JavaScript" src="lib/jsviz/0.3.3/physics/RungeKuttaIntegrator.js"></script>
		
	<script language="JavaScript" src="lib/jsviz/0.3.3/layout/graph/ForceDirectedLayout.js"></script>
	<script language="JavaScript" src="lib/jsviz/0.3.3/layout/view/HTMLGraphView.js"></script>
	<script language="JavaScript" src="lib/jsviz/0.3.3/layout/view/SVGGraphView.js"></script>

	<script language="JavaScript" src="lib/jsviz/0.3.3/util/Timer.js"></script>
	<script language="JavaScript" src="lib/jsviz/0.3.3/util/EventHandler.js"></script>

	<script language="JavaScript" src="lib/jsviz/0.3.3/io/DataGraph.js"></script>
	<script language="JavaScript" src="lib/jsviz/0.3.3/io/HTTP.js"></script>
	<script language="JavaScript" src="lib/jsviz/0.3.3/io/XMLTreeLoader.js"></script>

	<script language="JavaScript">

	    function GetSampleLayout() {

	        /* 
	        * If you're going to place the graph in an HTML Element, other
	        * the <body>, remember that it must have a known size and
	        * position (via element.offsetWidth, element.offsetHeight,
	        * element.offsetTop, element.offsetLeft).
	        */
	        var layout = new ForceDirectedLayout(document.body, true);

	        layout.config._default = {
	            model: function (dataNode) {
	                return {
	                    mass: .5
	                }
	            },
	            view: function (dataNode, particle) {

	                var element = $("<div><div></div></div>").css("position", "absolute");
	                var inner = element.find("div").css("position", "relative");

	                element.width(1);
	                element.height(1);
	                inner.width(particle.width);
	                inner.height(particle.height);
	                inner.css("left", -particle.width / 2);
	                inner.css("top", -particle.height / 2);
	                inner.css("background", "blue");

	                var result = element[0];

	                //				        var color = dataNode.color.replace("#", "");
	                //				        nodeElement.style.backgroundImage = "url(http://kylescholz.com/cgi-bin/bubble.pl?title=&r=20&pt=8&b=888888&c=" + color + ")";
	                //				        nodeElement.innerHTML = '<img width="1" height="1">';
	                result.onmousedown = new EventHandler(layout, layout.handleMouseDownEvent, particle.id)
	                return result;
	            }
	        }

	        layout.forces.spring._default = function (nodeA, nodeB, isParentChild) {
	            return {
	                springConstant: 0.2,
	                dampingConstant: 0.2,
	                restLength: 10
	            }
	        }

	        layout.forces.magnet = function () {
	            return {
	                magnetConstant: -4000,
	                minimumDistance: 10
	            }
	        }


	        /* 3) Override the default edge properties builder.
	        * 
	        * @return DOMElement
	        */
	        layout.viewEdgeBuilder = function (dataNodeSrc, dataNodeDest) {
	            if (this.svg) {
	                return {
	                    'stroke': dataNodeSrc.color,
	                    'stroke-width': '2px',
	                    'stroke-dasharray': '2,4'
	                }
	            } else {
	                return {
	                    'pixelColor': dataNodeSrc.color,
	                    'pixelWidth': '2px',
	                    'pixelHeight': '2px',
	                    'pixels': 10
	                }
	            }
	        }

	        /* 4) Load up some stuff by hand
	        * 
	        */

	        layout.model.ENTROPY_THROTTLE = false;

	        return layout;
	    }


	    function init() {

	        var layout = GetSampleLayout();

	        function getNode() {
	            var node = new DataGraphNode();
	            node.color = (Math.random() > .5) ? "#8888bb" : "#bb8888";
	            node.particle = new RectangleParticle(.5, 0, 0).SetDimensions(100, 20);
	            return node;
	        }

		    var nodes = [];
		    var namedNodes = {};

            function verifyNodeExists(name) {

                if (namedNodes[name])
                    return;

                var node = getNode();
		        layout.newDataGraphNode(node);

		        namedNodes[name] = node;
		        nodes.push(node);
		    }

		    globalDependencyGrapher.VisitDependencies(function (name, parent) {

                if (name)
                    verifyNodeExists(name);

                if (parent)
		            verifyNodeExists(parent);

		        if (name && parent) {
		            layout.newDataGraphEdge(namedNodes[name], namedNodes[parent]);
		        }
		    });
		    /* 5) Control the addition of nodes and edges with a timer.
		    * 
		    * This enables the graph to start organizng as data is loaded.
		    * Use a larger tick time for smoother animation, but slower
		    * build time.
		    */
		    var buildTimer = new Timer(150);
		    buildTimer.subscribe(layout);
		    buildTimer.start();
		}

		$(function () {
		    init();
		});
	</script>

</body>
</html>
  